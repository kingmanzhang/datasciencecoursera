---
title: "Simulations with exponential distribution"
author: Xingmin Aaron Zhang
output: pdf_document
---

In this project, we will investigate the exponential distribution in R and compare it with the Central Limit Theorem. The exponential distribution can be simulated in R with rexp(n, lambda) where lambda is the rate parameter. The mean of exponential distribution is 1/lambda and the standard deviation is also 1/lambda. Set lambda = 0.2 for all of the simulations. You will investigate the distribution of averages of 40 exponentials. Note that you will need to do a thousand simulations.

We randomly sample the exponential distribution (lambda = 0.2) for 40 numbers (n = 40) and repeated do this for 1000 simulations.
```{r}
n = 40
lambda = 0.2
N = 1000
set.seed(31237)
expMatrix <- matrix(rexp(n * N, rate = lambda), nrow = N, byrow = TRUE )
```

We calculate the mean of these 1000 samples, and create a histogram to show the distribution.
```{r}
expMean <- rowMeans(expMatrix)
{hist(expMean, xlab = "mean of 40 exponentials", ylab = "count", main = "histogram of means of exponentials")
abline(v = mean(expMean), col = "royalblue", lwd = 3)
text(x = 5, y = 160, labels = paste("mean = ", round(mean(expMean), 2)), pos = 4, col = "red")
}
```

For exponential distributions, both the mean and standard deviation is 1/lambda. For a sample of size n, the mean is still 1/lamba and the standard deviation of the mean will be 1/(lambda * sqrt(n)). If we compare the number with the theoretical values, we can see that they match quite well.
```{r}
mu = 1/lambda
sd = 1/lambda/sqrt(n)
meanAndSd <- data.frame(theoretical = c(mu, sd), observed = c(mean(expMean), sd(expMean)))
rownames(meanAndSd) = c("mean", "sd")
meanAndSd
```

For the theoretical normal distribution, if we sample 1000 values, the 95% confidence interval will be [`r mu + qnorm(0.025) * sd/sqrt(1000)` ~ `r mu + qnorm(0.975) * sd/sqrt(1000)`]. Therefore, the observed mean is in this interval, i.e. we accept null hypothesis. 


We can also fit the above histogram with a normal distribution curve and found that they match very well (left). The right side shows the distribution of original values for the simulations. One can see that while the original values follow the exponential distribution, the mean of samples follow normal distribution. 

```{r fig.width=9, fig.height=5, fig.align='center'}
par(mfrow = c(1, 2))
{hist(expMean, xlab = "mean of samples (n = 40)", ylab = "fraction", main = "distribution of means of samples", freq = FALSE)
abline(v = mean(expMean), col = "royalblue", lwd = 3)
text(x = 6, y = 0.3, labels = "theoretical\nnormal\ncurve", pos = 4, col = "red")
x <- seq(2, 8, by = 0.2)
curve(dnorm(x, mean = mean(expMean), sd = sd(expMean)),add = TRUE, col = "red", lwd = 2)
}

{
    rawNum <- as.vector(expMatrix)
    hist(rawNum, freq = FALSE, main = "distribution of raw values in simulation")
    x <- seq(min(rawNum), max(rawNum), by = 0.2)
    curve(dexp(x, rate = lambda), add = TRUE, col = "red", lwd = 2)
    text(x = 6, y = 0.08, labels = "theoretical exponential\ncurve", pos = 4, col = "red")
}
```

